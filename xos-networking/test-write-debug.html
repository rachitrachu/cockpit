<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Test Write Button Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5; 
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        #output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            min-height: 100px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>?? Test Write Button Debug</h1>
        
        <p>This simulates the Test Write button functionality to debug the issue:</p>
        
        <button id="test-netplan-action" class="btn">?? Test netplanAction</button>
        <button id="test-write-button" class="btn">?? Test Write Logic</button>
        
        <div id="output">Click a button to test...</div>
    </div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
        }
        
        // Simulate netplanAction response
        function simulateNetplanAction(action, config) {
            log(`?? Simulating netplanAction('${action}', ${JSON.stringify(config)})`);
            
            // Simulate different response scenarios
            const scenarios = [
                { result: 'success', error: null },           // Success case
                { result: null, error: 'Test error message' }, // Error case
                { result: 'success', error: null, debug_output: 'Test debug info' } // Success with debug
            ];
            
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            log(`?? Simulated response: ${JSON.stringify(scenario)}`);
            
            return Promise.resolve(scenario);
        }
        
        // Test netplanAction function
        document.getElementById('test-netplan-action').addEventListener('click', async () => {
            log('=== Testing netplanAction Function ===');
            
            const testConfig = {
                name: 'eth0',
                static_ip: '192.168.1.100/24',
                gateway: '192.168.1.1',
                dns: '8.8.8.8,1.1.1.1'
            };
            
            try {
                const result = await simulateNetplanAction('set_ip', testConfig);
                log(`? netplanAction completed: ${JSON.stringify(result)}`);
                
                if (result.error) {
                    log(`? Error detected: ${result.error}`);
                } else {
                    log(`? Success detected: ${result.result}`);
                }
            } catch (error) {
                log(`? Exception caught: ${error}`);
            }
        });
        
        // Test the full Test Write button logic
        document.getElementById('test-write-button').addEventListener('click', async () => {
            log('=== Testing Full Test Write Logic ===');
            
            try {
                log('?? Setting status to "Testing netplan write..."');
                
                // Test netplan action with a simple configuration
                const testConfig = {
                    name: 'eth0',
                    static_ip: '192.168.1.100/24',
                    gateway: '192.168.1.1',
                    dns: '8.8.8.8,1.1.1.1'
                };
                
                log(`?? Testing netplan action with config: ${JSON.stringify(testConfig)}`);
                const result = await simulateNetplanAction('set_ip', testConfig);
                
                log(`?? Netplan test result: ${JSON.stringify(result)}`);
                
                // This is the FIXED logic - no more parsing needed
                if (result.error) {
                    log(`? Test failed: ${result.error}`);
                    log('?? Would show alert: "? Netplan test failed"');
                } else {
                    log('? Test successful!');
                    log('?? Would show alert: "? Netplan test successful!"');
                    
                    // Simulate reading netplan content
                    log('?? Would try to read /etc/netplan/99-cockpit.yaml');
                    log('?? Simulated netplan content would be logged to console');
                }
            } catch (error) {
                log(`? Netplan test error: ${error}`);
                log('?? Would show alert with error message');
            } finally {
                log('?? Setting status back to "Ready"');
            }
        });
        
        log('?? Test Write debug page loaded');
    </script>
</body>
</html>