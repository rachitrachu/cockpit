<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>XOS Networking</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Cockpit API -->
  <script src="../base1/cockpit.js"></script>

  <!-- Styles -->
  <link href="style.css" rel="stylesheet">
  <link href="fallback-icons.css" rel="stylesheet">
  
  <!-- Icons (using Unicode emojis for now, can be replaced with icon font) -->
  <style>
    .icon { display: inline-block; width: 1em; margin-right: 0.5em; }
    
    /* Force UTF-8 encoding */
    @charset "UTF-8";
    
    /* Simple text-based symbols that always work */
    .simple-check { color: #28a745; font-weight: bold; }
    .simple-check::before { content: "[OK] "; }
    
    .simple-cross { color: #dc3545; font-weight: bold; }
    .simple-cross::before { content: "[X] "; }
    
    .simple-warning { color: #ffc107; font-weight: bold; }
    .simple-warning::before { content: "[!] "; }
    
    .simple-info { color: #17a2b8; font-weight: bold; }
    .simple-info::before { content: "[i] "; }
  </style>
</head>
<body>
  <div class="xos-container">
    <header class="xos-header">
      <div class="xos-title">
        <svg class="xos-logo" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="2"/>
        </svg>
        <h1>ğŸŒ XOS Networking</h1>
      </div>
      <div class="xos-actions">
        <button id="btn-refresh" class="btn primary">
          <span class="icon">ğŸ”„</span> Refresh All
        </button>
      </div>
    </header>

    <nav class="xos-tabs">
      <button class="tab active" data-tab="interfaces">
        <span class="icon">ğŸ”Œ</span> Interfaces
      </button>
      <button class="tab" data-tab="constructs">
        <span class="icon">ğŸ—ï¸</span> VLAN / Bridge / Bond
      </button>
      <button class="tab" data-tab="diagnostics">
        <span class="icon">ğŸ©º</span> Diagnostics
      </button>
    </nav>

    <main>
      <!-- Interfaces -->
      <section id="tab-interfaces" class="tab-panel active">
        <div class="toolbar">
          <div class="search">
            <input id="search-iface" placeholder="ğŸ” Search interfaces..." />
          </div>
          <div style="margin-left: 8px;">
            <label for="iface-sort" style="margin-right: 8px; font-weight: 500;">Sort by:</label>
            <select id="iface-sort" style="padding: 0.5rem; border-radius: var(--border-radius);">
              <option value="name">ğŸ“ Name</option>
              <option value="type">ğŸ·ï¸ Type</option>
              <option value="state">ğŸ“Š State</option>
            </select>
          </div>
          <div class="spacer"></div>
          <div class="quick-actions">
            <button id="btn-refresh-interfaces" class="btn">
              <span class="icon">ğŸ”„</span> Refresh
            </button>
            <button id="btn-show-netplan" class="btn btn-outline">
              <span class="icon">ğŸ“‹</span> Show Config
            </button>
            <button id="btn-apply-netplan" class="btn btn-outline">
              <span class="icon">âš¡</span> Apply Config
            </button>
            <button id="btn-test-netplan" class="btn btn-outline">
              <span class="icon">ğŸ§ª</span> Test Write
            </button>
            <button id="btn-check-netplan" class="btn btn-outline">
              <span class="icon">ğŸ”</span> Check File
            </button>
            <button id="btn-backup-netplan" class="btn btn-outline">
              <span class="icon">ğŸ’¾</span> Backup
            </button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table class="table" id="table-interfaces">
            <thead>
              <tr>
                <th>ğŸ”Œ Device</th>
                <th>ğŸ·ï¸ Type</th>
                <th>ğŸ“Š State</th>
                <th>ğŸ”– MAC</th>
                <th>ğŸŒ IPv4</th>
                <th>ğŸŒ IPv6</th>
                <th>ğŸ“ MTU</th>
                <th>âš™ï¸ Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- VLAN/Bridge/Bond -->
      <section id="tab-constructs" class="tab-panel">
        <div class="toolbar">
          <button id="btn-import-config" class="btn btn-outline">
            <span class="icon">ğŸ“¤</span> Import Config
          </button>
          <button id="btn-export-config" class="btn btn-outline">
            <span class="icon">ğŸ“¥</span> Export Config
          </button>
          <div class="spacer"></div>
          <button id="btn-reset-forms" class="btn btn-outline">
            <span class="icon">ğŸ”„</span> Reset Forms
          </button>
        </div>
        
        <div class="grid">
          <!-- VLAN -->
          <div class="card">
            <h3>ğŸ·ï¸ Create VLAN</h3>
            <label>ğŸ”Œ Parent Interface
              <select id="vlan-parent" required></select>
            </label>
            <label>ğŸ”¢ VLAN ID
              <input id="vlan-id" type="number" min="1" max="4094" required placeholder="10">
            </label>
            <label>ğŸ“› Interface Name (optional)
              <input id="vlan-name" type="text" pattern="[a-zA-Z0-9_.-]+" placeholder="eth0.10">
            </label>
            <div class="advanced-options">
              <details>
                <summary>âš™ï¸ Advanced Options</summary>
                <label>ğŸ“ MTU
                  <input id="vlan-mtu" type="number" min="68" max="9000" placeholder="1500">
                </label>
                <label>ğŸŒ Static IP (optional)
                  <input id="vlan-static-ip" placeholder="192.168.1.10/24">
                </label>
                <label>ğŸšª Gateway (optional)
                  <input id="vlan-gateway" placeholder="192.168.1.1">
                </label>
              </details>
            </div>
            <button id="btn-create-vlan" class="btn primary">
              <span class="icon">â•</span> Create VLAN
            </button>
            <pre id="vlan-out" class="out"></pre>
          </div>

          <!-- Bridge -->
          <div class="card">
            <h3>ğŸŒ‰ Create Bridge</h3>
            <label>ğŸ“› Bridge Name
              <input id="br-name" type="text" required pattern="[a-zA-Z0-9_.-]+" placeholder="br0">
            </label>
            <label>ğŸ”Œ Port Interfaces
              <input id="br-ports-filter" type="text" placeholder="Filter interfaces..." style="margin-bottom: 0.5rem;">
              <select id="br-ports" multiple required style="height:100px;"></select>
            </label>
            <div class="advanced-options">
              <details>
                <summary>âš™ï¸ Advanced Options</summary>
                <label>ğŸŒ² STP (Spanning Tree Protocol)
                  <select id="br-stp">
                    <option value="true">âœ… Enable</option>
                    <option value="false" selected>âŒ Disable</option>
                  </select>
                </label>
                <label>â±ï¸ Forward Delay (seconds)
                  <input id="br-forward-delay" type="number" min="2" max="30" placeholder="15">
                </label>
                <label>ğŸ‘‹ Hello Time (seconds)
                  <input id="br-hello-time" type="number" min="1" max="10" placeholder="2">
                </label>
              </details>
            </div>
            <button id="btn-create-bridge" class="btn primary">
              <span class="icon">â•</span> Create Bridge
            </button>
            <pre id="br-out" class="out"></pre>
          </div>

          <!-- Bond -->
          <div class="card">
            <h3>ğŸ”— Create Bond</h3>
            <label>ğŸ“› Bond Name
              <input id="bond-name" type="text" required pattern="[a-zA-Z0-9_.-]+" placeholder="bond0">
            </label>
            <label>âš™ï¸ Bonding Mode
              <select id="bond-mode" required>
                <option value="active-backup">ğŸ”„ Active-Backup (Failover)</option>
                <option value="balance-rr">âš–ï¸ Balance Round-Robin</option>
                <option value="balance-xor">ğŸ”€ Balance XOR</option>
                <option value="broadcast">ğŸ“¡ Broadcast</option>
                <option value="802.3ad">ğŸ”— 802.3ad (LACP)</option>
                <option value="balance-tlb">âš¡ Balance TLB</option>
                <option value="balance-alb">âš¡ Balance ALB</option>
              </select>
            </label>
            <label>ğŸ”Œ Slave Interfaces (select two or more)
              <input id="bond-slaves-filter" type="text" placeholder="Filter interfaces..." style="margin-bottom: 0.5rem;">
              <select id="bond-slaves" multiple required style="height:100px;"></select>
            </label>
            <div class="advanced-options">
              <details>
                <summary>âš™ï¸ Advanced Options</summary>
                <label>â±ï¸ MII Monitoring Interval (ms)
                  <input id="bond-miimon" type="number" min="0" placeholder="100">
                </label>
                <label>ğŸ‘‘ Primary Interface (for active-backup)
                  <select id="bond-primary"></select>
                </label>
                <label>ğŸ“Š Link Monitoring
                  <select id="bond-link-mon">
                    <option value="miimon">ğŸ“¡ MII Monitor</option>
                    <option value="arpmon">ğŸŒ ARP Monitor</option>
                  </select>
                </label>
              </details>
            </div>
            <button id="btn-create-bond" class="btn primary">
              <span class="icon">â•</span> Create Bond
            </button>
            <pre id="bond-out" class="out"></pre>
          </div>
        </div>
      </section>

      <!-- Diagnostics -->
      <section id="tab-diagnostics" class="tab-panel">
        <div class="card">
          <h3>ğŸ©º Network Diagnostics</h3>
          <div style="display: flex; gap: 1rem; align-items: end; margin-bottom: 1.5rem; flex-wrap: wrap;">
            <label style="flex: 1; min-width: 200px;">ğŸ¯ Target Host/IP
              <input id="diag-host" placeholder="8.8.8.8" value="8.8.8.8">
            </label>
            <button id="btn-ping" class="btn primary">
              <span class="icon">ğŸ“¡</span> Ping
            </button>
            <button id="btn-traceroute" class="btn btn-outline">
              <span class="icon">ğŸ—ºï¸</span> Traceroute
            </button>
          </div>
        </div>
        
        <div class="grid">
          <div class="card">
            <h3>ğŸ“¡ Ping Results</h3>
            <pre id="ping-out" class="out" style="min-height: 200px;">Click "Ping" to test connectivity...</pre>
          </div>
          <div class="card">
            <h3>ğŸ›£ï¸ Routing Table</h3>
            <pre id="routes-out" class="out" style="min-height: 200px;">Loading routes...</pre>
          </div>
          <div class="card">
            <h3>ğŸŒ DNS Configuration</h3>
            <pre id="dns-out" class="out" style="min-height: 200px;">Loading DNS config...</pre>
          </div>
        </div>
      </section>
    </main>

    <footer class="xos-footer">
      <span id="status">Ready</span> | XOS Networking Management Interface
    </footer>
  </div>
  <!-- JavaScript Modules (loaded in order) -->
  <script src="unicode-fix.js"></script>
  <script src="js/core.js"></script>
  <script src="js/modals.js"></script>
  <script src="js/netplan.js"></script>
  <script src="js/network-interface.js"></script>
  <script src="js/forms.js"></script>
  <script src="js/diagnostics.js"></script>
  <script src="js/event-handlers.js"></script>
  <script src="main.js"></script>
</body>
</html>
