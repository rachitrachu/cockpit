<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAVS Network Management</title>
    <script src="../base1/cockpit.js"></script>
    <link rel="stylesheet" href="../xavs-images/xavs-images.css">
    <link rel="stylesheet" href="network-management.css">
    <link rel="stylesheet" href="fontawesome/css/all.min.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <div class="topbar">
            <h1 class="app-title">
                <i class="fas fa-network-wired"></i>
                XAVS Network Management
            </h1>
            <div class="help" data-tip="Network Management Infrastructure using systemd-networkd with Netplan

Features:
• Configure network interfaces (static/DHCP)
• Manage VLANs and bridges
• Configure bonding and high availability
• Monitor network status and troubleshoot
• Version control and rollback capabilities
• Security and compliance management">?</div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav-tabs">
            <li><a href="#overview" class="nav-link active" data-tab="overview">
                <i class="fas fa-tachometer-alt"></i>Overview
            </a></li>
            <li><a href="#interfaces" class="nav-link" data-tab="interfaces">
                <i class="fas fa-ethernet"></i>Interfaces
            </a></li>
            <li><a href="#vlans" class="nav-link" data-tab="vlans">
                <i class="fas fa-sitemap"></i>VLANs
            </a></li>
            <li><a href="#bridges" class="nav-link" data-tab="bridges">
                <i class="fas fa-bridge"></i>Bridges
            </a></li>
            <li><a href="#bonds" class="nav-link" data-tab="bonds">
                <i class="fas fa-link"></i>Bonds
            </a></li>
            <li><a href="#routes" class="nav-link" data-tab="routes">
                <i class="fas fa-route"></i>Routes
            </a></li>
            <li><a href="#dns" class="nav-link" data-tab="dns">
                <i class="fas fa-server"></i>DNS
            </a></li>
            <li><a href="#monitoring" class="nav-link" data-tab="monitoring">
                <i class="fas fa-chart-line"></i>Monitoring
            </a></li>
            <li><a href="#config" class="nav-link" data-tab="config">
                <i class="fas fa-cog"></i>Configuration
            </a></li>
            <li><a href="#logs" class="nav-link" data-tab="logs">
                <i class="fas fa-terminal"></i>Logs
            </a></li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Overview Tab -->
            <div id="overview" class="tab-pane show">
                <div class="overview-grid">
                    <!-- System Status Card -->
                    <div class="status-card">
                        <div class="status-card-header">
                            <i class="status-icon fas fa-server"></i>
                            <h3>System Status</h3>
                        </div>
                        <div class="status-card-body">
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">systemd-networkd</span>
                                    <span class="status-value" id="networkd-status">
                                        <span class="status-dot" id="networkd-dot"></span>
                                        Checking...
                                    </span>
                                </div>
                            </div>
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">systemd-resolved</span>
                                    <span class="status-value" id="resolved-status">
                                        <span class="status-dot" id="resolved-dot"></span>
                                        Checking...
                                    </span>
                                </div>
                            </div>
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">Active Renderer</span>
                                    <span class="status-value" id="renderer-status">networkd</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interface Summary Card -->
                    <div class="status-card">
                        <div class="status-card-header">
                            <i class="status-icon fas fa-ethernet"></i>
                            <h3>Network Interfaces</h3>
                        </div>
                        <div class="status-card-body">
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">Total Interfaces</span>
                                    <span class="status-value" id="total-interfaces">0</span>
                                </div>
                            </div>
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">Active Interfaces</span>
                                    <span class="status-value" id="active-interfaces">0</span>
                                </div>
                            </div>
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">DHCP Interfaces</span>
                                    <span class="status-value" id="dhcp-interfaces">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration Status Card -->
                    <div class="status-card">
                        <div class="status-card-header">
                            <i class="status-icon fas fa-file-code"></i>
                            <h3>Configuration Status</h3>
                        </div>
                        <div class="status-card-body">
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">Last Modified</span>
                                    <span class="status-value" id="last-modified">Unknown</span>
                                </div>
                            </div>
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">Backup Available</span>
                                    <span class="status-value" id="backup-status">Yes</span>
                                </div>
                            </div>
                            <div class="status-detail">
                                <div class="status-info">
                                    <span class="status-label">Syntax Status</span>
                                    <span class="status-value" id="syntax-status">
                                        <span class="status-dot ok"></span>
                                        Valid
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="refreshSystemStatus()">
                            <i class="fas fa-sync-alt"></i> Refresh Status
                        </button>
                        <button class="btn btn-outline-brand" onclick="validateConfiguration()">
                            <i class="fas fa-check-circle"></i> Validate Config
                        </button>
                        <button class="btn btn-outline-brand" onclick="backupConfiguration()">
                            <i class="fas fa-save"></i> Create Backup
                        </button>
                        <button class="btn btn-outline-secondary" onclick="viewLogs()">
                            <i class="fas fa-file-alt"></i> View Logs
                        </button>
                    </div>
                </div>

                <!-- System Logs -->
                <div class="log-section">
                    <h3>Recent System Events</h3>
                    <div class="alert" id="system-logs">
                        Loading system logs...
                    </div>
                </div>
            </div>

            <!-- Network Interfaces Tab -->
            <div id="interfaces" class="tab-pane">
                <div class="tab-header">
                    <h2>Network Interface Management</h2>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="addInterface()">
                            <i class="fas fa-plus"></i> Add Interface
                        </button>
                        <button class="btn btn-outline-brand" onclick="refreshInterfaces()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-outline-secondary" onclick="debugNetplanConfiguration('interfaces')">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                    </div>
                </div>

                <div class="interface-controls">
                    <div class="form-group">
                        <label class="form-label">Filter by Type:</label>
                        <select class="form-control" id="interface-filter" onchange="filterInterfaces()">
                            <option value="all">All Interfaces</option>
                            <option value="ethernet">Ethernet</option>
                            <option value="vlan">VLAN</option>
                            <option value="bond">Bond</option>
                            <option value="bridge">Bridge</option>
                            <option value="virtual">Virtual</option>
                        </select>
                    </div>
                </div>

                <div class="interface-list" id="interface-list">
                    <!-- Dynamic interface list will be populated here -->
                </div>
            </div>

            <!-- VLANs Tab -->
            <div id="vlans" class="tab-pane">
                <div class="tab-header">
                    <h2>VLAN Configuration</h2>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="addVlan()">
                            <i class="fas fa-plus"></i> Add VLAN
                        </button>
                        <button class="btn btn-outline-secondary" onclick="cleanupNetplanConflicts()">
                            <i class="fas fa-broom"></i> Cleanup Conflicts
                        </button>
                        <button class="btn btn-outline-danger" onclick="emergencyCleanupCorruptedVlans()" title="Emergency cleanup for corrupted VLAN configurations with null links">
                            <i class="fas fa-ambulance"></i> Emergency Cleanup
                        </button>
                        <button class="btn btn-outline-warning" onclick="debugNetplanConfiguration()" title="Run netplan --debug try and show detailed output in console">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                        <button class="btn btn-outline-info" onclick="diagnosticVlanConfiguration()" title="Run comprehensive VLAN diagnostic and show detailed report in console">
                            <i class="fas fa-stethoscope"></i> Diagnostic
                        </button>
                        <button class="btn btn-outline-brand" onclick="refreshVlans()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="vlan-list" id="vlan-list">
                    <!-- Dynamic VLAN list will be populated here -->
                </div>
            </div>

            <!-- Bridges Tab -->
            <div id="bridges" class="tab-pane">
                <div class="tab-header">
                    <h2>Bridge Configuration</h2>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="addBridge()">
                            <i class="fas fa-plus"></i> Add Bridge
                        </button>
                        <button class="btn btn-outline-brand" onclick="refreshBridges()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="bridge-list" id="bridge-list">
                    <!-- Dynamic bridge list will be populated here -->
                </div>
            </div>

            <!-- Bonds Tab -->
            <div id="bonds" class="tab-pane">
                <div class="tab-header">
                    <h2>Bond/Aggregation Configuration</h2>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="addBond()">
                            <i class="fas fa-plus"></i> Add Bond
                        </button>
                        <button class="btn btn-outline-brand" onclick="refreshBonds()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-outline-secondary" onclick="debugNetplanConfiguration('bonds')">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                    </div>
                </div>

                <div class="bond-list" id="bond-list">
                    <!-- Dynamic bond list will be populated here -->
                </div>
            </div>

            <!-- Routes Tab -->
            <div id="routes" class="tab-pane">
                <div class="tab-header">
                    <h2>Routing Configuration</h2>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="addRoute()">
                            <i class="fas fa-plus"></i> Add Route
                        </button>
                        <button class="btn btn-outline-brand" onclick="refreshRoutes()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-outline-secondary" onclick="debugNetplanConfiguration('routes')">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                    </div>
                </div>

                <div class="route-list" id="route-list">
                    <!-- Dynamic route list will be populated here -->
                </div>
            </div>

            <!-- DNS Tab -->
            <div id="dns" class="tab-pane">
                <div class="tab-header">
                    <h2>DNS Configuration</h2>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="addDnsServer()">
                            <i class="fas fa-plus"></i> Add DNS Server
                        </button>
                        <button class="btn btn-outline-brand" onclick="refreshDns()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-outline-secondary" onclick="debugNetplanConfiguration('dns')">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                    </div>
                </div>

                <div class="dns-config" id="dns-config">
                    <!-- DNS configuration will be populated here -->
                </div>
            </div>

            <!-- Monitoring Tab -->
            <div id="monitoring" class="tab-pane">
                <div class="tab-header">
                    <h2>Network Monitoring</h2>
                    <div class="actions">
                        <button class="btn btn-outline-brand" onclick="refreshMonitoring()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-outline-secondary" onclick="exportLogs()">
                            <i class="fas fa-download"></i> Export Logs
                        </button>
                    </div>
                </div>

                <div class="monitoring-dashboard" id="monitoring-dashboard">
                    <!-- Monitoring dashboard will be populated here -->
                </div>
            </div>

            <!-- Configuration Tab -->
            <div id="config" class="tab-pane">
                <div class="tab-header">
                    <h2>Configuration Management</h2>
                    <div class="actions">
                        <button class="btn btn-brand" onclick="applyConfiguration()">
                            <i class="fas fa-play"></i> Apply Configuration
                        </button>
                        <button class="btn btn-outline-brand" onclick="validateAllConfigs()">
                            <i class="fas fa-check-circle"></i> Validate All
                        </button>
                        <button class="btn btn-outline-secondary" onclick="rollbackConfiguration()">
                            <i class="fas fa-undo"></i> Rollback
                        </button>
                    </div>
                </div>

                <div class="config-management" id="config-management">
                    <!-- Configuration management will be populated here -->
                </div>
            </div>

            <!-- Logs Tab -->
            <div id="logs" class="tab-pane">
                <div class="logs-container">
                    <div class="logs-header">
                        <h3><i class="fas fa-terminal"></i> Network Management Logs</h3>
                        <div class="logs-actions">
                            <button class="btn btn-outline-muted" id="btn-clear-log" type="button">
                                <i class="fas fa-trash"></i> Clear Log
                            </button>
                        </div>
                    </div>
                    <div class="logs-content">
                        <pre class="log-terminal" id="log"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <span id="status-text">Ready</span>
            <span class="status-actions">
                <a href="#" class="status-link" data-tab="logs">View Logs</a>
            </span>
        </div>
    </div>

    <!-- Modals will be dynamically created here -->
    <div id="modal-container"></div>

    <script src="network-management.js"></script>
    <script src="vlan-manager.js"></script>
    <script src="bridge-manager.js"></script>
    <script src="bond-manager.js"></script>
    <script src="monitoring-config.js"></script>
</body>
</html>
