<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XOS Networking - Functionality Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="clean-style.css" rel="stylesheet">
</head>
<body>
    <div class="xos-container">
        <header class="xos-header">
            <div class="xos-title">
                <h1>XOS Networking - Functionality Test</h1>
            </div>
        </header>

        <nav class="xos-tabs">
            <button class="tab active" data-tab="interfaces">Test Results</button>
        </nav>

        <main>
            <section id="tab-interfaces" class="tab-panel active">
                <div id="test-results">
                    <h2>Module Loading Tests</h2>
                    <div id="module-tests"></div>
                    
                    <h2>Function Availability Tests</h2>
                    <div id="function-tests"></div>
                    
                    <h2>Console Output</h2>
                    <pre id="console-output" style="background: #f8f9fa; padding: 1rem; max-height: 300px; overflow-y: auto;"></pre>
                </div>
            </section>
        </main>

        <footer class="xos-footer">
            <span id="status">Testing...</span> | XOS Networking Test
        </footer>
    </div>

    <!-- Load all modules like index.html does -->
    <script src="js/core.js"></script>
    <script src="js/network-interface.js"></script>
    <script src="js/forms.js"></script>
    <script src="js/diagnostics.js"></script>
    <script src="js/event-handlers.js"></script>
    <script src="main.js"></script>

    <script>
        // Test harness
        const testResults = [];
        const originalLog = console.log;
        const originalError = console.error;
        const consoleMessages = [];

        // Capture console output
        console.log = function(...args) {
            consoleMessages.push(`LOG: ${args.join(' ')}`);
            originalLog.apply(console, args);
            updateConsoleOutput();
        };

        console.error = function(...args) {
            consoleMessages.push(`ERROR: ${args.join(' ')}`);
            originalError.apply(console, args);
            updateConsoleOutput();
        };

        function updateConsoleOutput() {
            const output = document.getElementById('console-output');
            if (output) {
                output.textContent = consoleMessages.join('\n');
                output.scrollTop = output.scrollHeight;
            }
        }

        function addTest(name, passed, details = '') {
            testResults.push({name, passed, details});
            updateTestDisplay();
        }

        function updateTestDisplay() {
            const moduleDiv = document.getElementById('module-tests');
            const functionDiv = document.getElementById('function-tests');
            
            if (!moduleDiv || !functionDiv) return;

            // Clear previous results
            moduleDiv.innerHTML = '';
            functionDiv.innerHTML = '';

            testResults.forEach(test => {
                const div = document.createElement('div');
                div.style.cssText = `
                    padding: 0.5rem;
                    margin: 0.5rem 0;
                    border-radius: 0.25rem;
                    border: 1px solid;
                    ${test.passed ? 
                        'background: #d4edda; color: #155724; border-color: #c3e6cb;' : 
                        'background: #f8d7da; color: #721c24; border-color: #f5c6cb;'
                    }
                `;
                
                div.innerHTML = `
                    <strong>${test.passed ? '?' : '?'} ${test.name}</strong>
                    ${test.details ? `<br><small>${test.details}</small>` : ''}
                `;

                // Separate module tests from function tests
                if (test.name.includes('Module:') || test.name.includes('XOSNetworking')) {
                    moduleDiv.appendChild(div);
                } else {
                    functionDiv.appendChild(div);
                }
            });
        }

        // Run tests
        function runTests() {
            console.log('Starting XOS Networking functionality tests...');

            // Test 1: Module Loading
            const modules = [
                ['XOSNetworking Base', typeof window.XOSNetworking !== 'undefined'],
                ['Core Module', typeof window.XOSNetworking?.core !== 'undefined'],
                ['Network Interface Module', typeof window.XOSNetworking?.networkInterface !== 'undefined'],
                ['Forms Module', typeof window.XOSNetworking?.forms !== 'undefined'],
                ['Diagnostics Module', typeof window.XOSNetworking?.diagnostics !== 'undefined'],
                ['Event Handlers Module', typeof window.XOSNetworking?.eventHandlers !== 'undefined']
            ];

            modules.forEach(([name, result]) => {
                addTest(`Module: ${name}`, result);
            });

            // Test 2: Core Functions
            const coreFunctions = [
                ['$ DOM Helper', typeof window.XOSNetworking?.core?.$ === 'function'],
                ['setStatus Function', typeof window.XOSNetworking?.core?.setStatus === 'function'],
                ['waitForReady Function', typeof window.XOSNetworking?.core?.waitForReady === 'function'],
                ['setupTabs Function', typeof window.XOSNetworking?.core?.setupTabs === 'function'],
                ['run Command Function', typeof window.XOSNetworking?.core?.run === 'function']
            ];

            coreFunctions.forEach(([name, result]) => {
                addTest(`Core: ${name}`, result);
            });

            // Test 3: Network Interface Functions
            const networkFunctions = [
                ['loadInterfaces Function', typeof window.XOSNetworking?.networkInterface?.loadInterfaces === 'function'],
                ['setupInterfaceFiltering Function', typeof window.XOSNetworking?.networkInterface?.setupInterfaceFiltering === 'function']
            ];

            networkFunctions.forEach(([name, result]) => {
                addTest(`Network: ${name}`, result);
            });

            // Test 4: Forms Functions
            const formsFunctions = [
                ['setupNetworkingForms Function', typeof window.XOSNetworking?.forms?.setupNetworkingForms === 'function'],
                ['createVLAN Function', typeof window.XOSNetworking?.forms?.createVLAN === 'function']
            ];

            formsFunctions.forEach(([name, result]) => {
                addTest(`Forms: ${name}`, result);
            });

            // Test 5: Diagnostics Functions
            const diagFunctions = [
                ['runPing Function', typeof window.XOSNetworking?.diagnostics?.runPing === 'function'],
                ['loadDiagnostics Function', typeof window.XOSNetworking?.diagnostics?.loadDiagnostics === 'function']
            ];

            diagFunctions.forEach(([name, result]) => {
                addTest(`Diagnostics: ${name}`, result);
            });

            // Test 6: Try calling core functions
            try {
                if (window.XOSNetworking?.core?.$) {
                    const body = window.XOSNetworking.core.$('body');
                    addTest('DOM Query Function Works', !!body);
                }
            } catch (e) {
                addTest('DOM Query Function Works', false, e.message);
            }

            // Summary
            const totalTests = testResults.length;
            const passedTests = testResults.filter(t => t.passed).length;
            const passRate = ((passedTests / totalTests) * 100).toFixed(1);

            console.log(`Tests completed: ${passedTests}/${totalTests} passed (${passRate}%)`);
            
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.textContent = `Tests: ${passedTests}/${totalTests} passed (${passRate}%)`;
                statusEl.style.color = passedTests === totalTests ? 'green' : 'orange';
            }
        }

        // Wait for modules to load, then run tests
        setTimeout(runTests, 2000);
    </script>
</body>
</html>