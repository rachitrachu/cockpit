<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>xAVS Deployment - Enhanced UI Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page-wrap">
    <h1>xAVS Deployment - Enhanced UI Demo</h1>

    <!-- ROW 1: Controls -->
    <div class="card controls-card">
      <header>Controls</header>
      <div class="body">
        <div class="controls-grid">
          <div class="flex-col">
            <div class="hdr">Action</div>
            <select id="command" class="btn" aria-label="xAVS command">
              <option value="bootstrap-servers" selected>bootstrap-servers</option>
              <option value="prechecks">prechecks</option>
              <option value="deploy">deploy</option>
              <option value="post-deploy">post-deploy</option>
            </select>
          </div>

          <div class="flex-col">
            <div class="hdr">Services (optional)</div>
            <small class="help-text">Select services to target with --tags</small>
            <div id="services-grid" class="services-grid">
              <span class="chip" data-svc="keystone">keystone</span>
              <span class="chip" data-svc="glance">glance</span>
              <span class="chip" data-svc="nova">nova</span>
              <span class="chip" data-svc="neutron">neutron</span>
              <span class="chip" data-svc="cinder">cinder</span>
              <span class="chip" data-svc="horizon">horizon</span>
            </div>
            <input id="custom-services" class="btn ghost mono" placeholder="Other services (comma separated)">
          </div>

          <!-- hosts with new UI -->
          <div class="flex-col">
            <div class="hdr">
              Hosts
              <button id="refreshHostsBtn" class="btn ghost small" style="margin-left: 8px;">â†» Refresh</button>
            </div>
            
            <!-- Host selection tabs -->
            <div class="host-tabs">
              <button class="host-tab active" data-tab="all">All Hosts</button>
              <button class="host-tab" data-tab="limit">Limit Hosts</button>
              <button class="host-tab" data-tab="tags">Host Patterns</button>
            </div>
            
            <!-- All hosts mode -->
            <div id="all-hosts-tab" class="host-tab-content active">
              <div class="host-option">
                <label><input type="radio" name="host-mode" value="all" checked> Use all hosts from inventory</label>
              </div>
            </div>
            
            <!-- Limit hosts mode -->
            <div id="limit-hosts-tab" class="host-tab-content">
              <div class="host-option">
                <label><input type="radio" name="host-mode" value="limit"> Limit to specific hosts (--limit):</label>
              </div>
              <div id="limit-hosts-box" class="host-selection-box brand-outline">
                <label><input type="checkbox" class="bxc"> controller-1</label>
                <label><input type="checkbox" class="bxc"> controller-2</label>
                <label><input type="checkbox" class="bxc"> compute-1</label>
                <label><input type="checkbox" class="bxc"> compute-2</label>
              </div>
            </div>
            
            <!-- Tag hosts mode -->
            <div id="tags-hosts-tab" class="host-tab-content">
              <div class="host-option">
                <label><input type="radio" name="host-mode" value="tags"> Target hosts by patterns (--limit):</label>
              </div>
              <div class="tag-selection">
                <input id="tag-input" class="btn ghost mono" placeholder="Enter host patterns (e.g., control,compute,controller-*)" disabled>
                <small class="help-text">Use Ansible patterns: groups, wildcards, or comma-separated hosts</small>
              </div>
            </div>
            
            <div class="hdr">Available Hosts</div>
            <div id="available-hosts" class="host-list">
              <span class="host-item">controller-1</span><span class="host-separator">, </span>
              <span class="host-item">controller-2</span><span class="host-separator">, </span>
              <span class="host-item">compute-1</span><span class="host-separator">, </span>
              <span class="host-item">compute-2</span><span class="host-separator">, </span>
              <span class="host-item">storage-1</span><span class="host-separator">, </span>
              <span class="host-item">storage-2</span>
            </div>
            <div class="hdr">Selected Configuration</div>
            <div id="selected-hosts"><span class="pill">All hosts (6 hosts)</span></div>
            
            <div class="hdr">Example Command</div>
            <div id="example-command" class="example-command">
              <code>kolla-ansible -i /root/xdeploy/nodes bootstrap-servers</code>
            </div>
          </div>

          <div class="controls-actions">
            <button id="runBtn" class="btn primary">Run</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ROW 2: Deployment Progress -->
    <div class="card deployment-progress-card">
      <header>
        <div class="console-toolbar">
          <span>Deployment Progress</span>
          <div class="toolbar-actions">
            <button id="clearBtn" class="btn ghost small">Clear</button>
          </div>
        </div>
      </header>
      <div class="body" id="progress-body">
        <!-- Progress Section -->
        <div id="progress-section" class="progress-section">
          <div id="playbook-progress" class="playbook-progress">
            <div class="playbook-name">ðŸ“‹ OpenStack Bootstrap</div>
            <div class="playbook-status">Running...</div>
          </div>
          <div id="summary-stats" class="summary-stats">
            <div class="stat-item ok">âœ“ 12</div>
            <div class="stat-item changed">âš¡ 3</div>
            <div class="stat-item failed">âœ— 1</div>
            <div class="stat-item skipped">âŠ˜ 2</div>
            <div class="stat-item unreachable">âš  0</div>
          </div>
        </div>
        
        <!-- Task Progress -->
        <div class="tasks-container">
          <div class="tasks-header">
            <span>Task Progress</span>
            <span class="task-count" id="task-count">(18 tasks)</span>
            <button id="toggleTasksBtn" class="btn ghost small">âˆ’</button>
          </div>
          <div id="tasks-list" class="tasks-list">
            <div class="task-item ok">
              <div class="task-header">
                <span class="task-status">âœ“</span>
                <span class="task-name">Gather facts</span>
                <span class="task-host">controller-1</span>
                <span class="task-duration">(2.3s)</span>
              </div>
            </div>
            <div class="task-item changed">
              <div class="task-header">
                <span class="task-status">âš¡</span>
                <span class="task-name">Install packages</span>
                <span class="task-host">controller-1</span>
                <span class="task-duration">(45.2s)</span>
              </div>
              <div class="task-msg">3 packages updated</div>
            </div>
            <div class="task-item failed">
              <div class="task-header">
                <span class="task-status">âœ—</span>
                <span class="task-name">Configure service</span>
                <span class="task-host">controller-2</span>
                <span class="task-duration">(1.2s)</span>
              </div>
              <div class="task-msg">Connection refused: port 22</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ROW 3: Raw Output -->
    <div class="card console-card">
      <header>
        <div class="console-toolbar">
          <span>Raw Output</span>
          <button id="toggleConsoleBtn" class="btn ghost small">âˆ’</button>
        </div>
      </header>
      <div class="body" id="console-body">
        <div id="console-output" class="scroll mono console-output">PLAY [Bootstrap OpenStack Services] ******************************************

TASK [Gather facts] **********************************************************
ok: [controller-1]
ok: [controller-2]

TASK [Install required packages] *********************************************
changed: [controller-1] => {"changed": true, "msg": "3 packages updated"}
changed: [controller-2] => {"changed": true, "msg": "2 packages updated"}

TASK [Configure database] ****************************************************
ok: [controller-1]
failed: [controller-2] => {"msg": "Connection refused: port 22", "unreachable": false}
        </div>
      </div>
    </div>
  </div>

  <script>
    // Demo JavaScript for testing the UI
    document.addEventListener('DOMContentLoaded', () => {
      const hostTabs = document.querySelectorAll('.host-tab');
      const hostTabContents = document.querySelectorAll('.host-tab-content');
      const hostModeRadios = document.querySelectorAll('input[name="host-mode"]');
      const tagInput = document.getElementById('tag-input');
      const selectedHosts = document.getElementById('selected-hosts');
      
      // Host tabs functionality
      hostTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.dataset.tab;
          
          hostTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          hostTabContents.forEach(content => content.classList.remove('active'));
          document.getElementById(`${tabId}-hosts-tab`).classList.add('active');
          
          const radio = document.querySelector(`input[name="host-mode"][value="${tabId}"]`);
          if (radio) radio.checked = true;
          
          updateUI(tabId);
        });
      });
      
      hostModeRadios.forEach(radio => {
        radio.addEventListener('change', () => updateUI(radio.value));
      });
      
      function updateUI(mode) {
        tagInput.disabled = mode !== 'tags';
        
        let configText = '';
        let exampleCmd = 'kolla-ansible -i /root/xdeploy/nodes bootstrap-servers';
        
        // Get selected services for --tags
        const selectedServices = Array.from(document.querySelectorAll('.chip.active')).map(chip => chip.dataset.svc);
        if (selectedServices.length > 0) {
          exampleCmd += ` --tags ${selectedServices.join(',')}`;
        }
        
        switch (mode) {
          case 'all': 
            configText = 'All hosts (6 hosts)'; 
            break;
          case 'limit': 
            configText = 'No hosts selected for limit';
            exampleCmd += ' --limit controller-1,controller-2';
            break;
          case 'tags': 
            configText = 'No patterns specified';
            exampleCmd += ' --limit control,compute';
            break;
        }
        
        selectedHosts.innerHTML = `<span class="pill">${configText}</span>`;
        document.getElementById('example-command').innerHTML = `<code>${exampleCmd}</code>`;
      }
      
      // Collapsible sections
      document.getElementById('toggleTasksBtn').addEventListener('click', function() {
        const tasksList = document.getElementById('tasks-list');
        const isCollapsed = tasksList.style.display === 'none';
        tasksList.style.display = isCollapsed ? 'block' : 'none';
        this.textContent = isCollapsed ? 'âˆ’' : '+';
      });
      
      document.getElementById('toggleConsoleBtn').addEventListener('click', function() {
        const body = document.getElementById('console-body');
        const isCollapsed = body.style.display === 'none';
        body.style.display = isCollapsed ? 'block' : 'none';
        this.textContent = isCollapsed ? 'âˆ’' : '+';
      });
      
      // Service chips
      document.getElementById('services-grid').addEventListener('click', (e) => {
        const chip = e.target.closest('.chip');
        if (chip) {
          chip.classList.toggle('active');
          // Update example command when services change
          const currentMode = document.querySelector('input[name="host-mode"]:checked').value;
          updateUI(currentMode);
        }
      });
    });
  </script>
</body>
</html>
