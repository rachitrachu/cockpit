<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Toggle Debug Test</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page-wrap">
    <h1>Minimize/Toggle Debug Test</h1>

    <!-- Task Progress Section -->
    <div class="card deployment-progress-card">
      <header>
        <div class="console-toolbar">
          <span>Deployment Progress</span>
        </div>
      </header>
      <div class="body" id="progress-body">
        <div class="tasks-container">
          <div class="tasks-header">
            <span>Task Progress</span>
            <span class="task-count" id="task-count">(0 tasks)</span>
            <button id="toggleTasksBtn" class="btn ghost small">−</button>
          </div>
          <div id="tasks-list" class="tasks-list">
            <div class="task-item ok">
              <div class="task-header">
                <span class="task-status">✓</span>
                <span class="task-name">Test Task 1</span>
                <span class="task-host">controller-1</span>
                <span class="task-duration">(2.3s)</span>
              </div>
            </div>
            <div class="task-item changed">
              <div class="task-header">
                <span class="task-status">⚡</span>
                <span class="task-name">Test Task 2</span>
                <span class="task-host">controller-2</span>
                <span class="task-duration">(5.1s)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Raw Output Section -->
    <div class="card console-card">
      <header>
        <div class="console-toolbar">
          <span>Raw Output</span>
          <div class="toolbar-actions">
            <button id="toggleConsoleBtn" class="btn ghost small">−</button>
          </div>
        </div>
      </header>
      <div class="body" id="console-body">
        <div id="console-output" class="scroll mono console-output">
PLAY [Test] ********************************************************

TASK [Gather facts] **********************************************************
ok: [controller-1]
ok: [controller-2]

TASK [Install packages] *******************************************************
changed: [controller-1] => {"changed": true, "msg": "Packages installed"}
changed: [controller-2] => {"changed": true, "msg": "Packages installed"}

PLAY RECAP ********************************************************************
controller-1               : ok=2    changed=1    unreachable=0    failed=0    skipped=0
controller-2               : ok=2    changed=1    unreachable=0    failed=0    skipped=0
        </div>
      </div>
    </div>

    <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
      <h3>Debug Info:</h3>
      <div id="debug-info"></div>
      
      <h3>Test Instructions:</h3>
      <ol>
        <li>Click the "−" button in Task Progress header - tasks list should hide/show</li>
        <li>Click the "−" button in Raw Output header - console output should hide/show</li>
        <li>Check debug info below for element detection</li>
      </ol>
    </div>
  </div>

  <script>
    // Debug logging
    function logDebug(message) {
      const debugInfo = document.getElementById('debug-info');
      debugInfo.innerHTML += `<div>${message}</div>`;
    }

    // Element references
    const els = {
      toggleTasksBtn: document.getElementById("toggleTasksBtn"),
      toggleConsoleBtn: document.getElementById("toggleConsoleBtn"),
      tasksList: document.getElementById("tasks-list"),
      consoleBody: document.getElementById("console-body")
    };

    // Debug element detection
    logDebug(`toggleTasksBtn found: ${!!els.toggleTasksBtn}`);
    logDebug(`toggleConsoleBtn found: ${!!els.toggleConsoleBtn}`);
    logDebug(`tasksList found: ${!!els.tasksList}`);
    logDebug(`consoleBody found: ${!!els.consoleBody}`);

    function initCollapsibleSections() {
      logDebug('Initializing collapsible sections...');
      
      if (els.toggleTasksBtn && els.tasksList) {
        logDebug('Setting up toggleTasksBtn event listener');
        els.toggleTasksBtn.addEventListener('click', () => {
          logDebug('toggleTasksBtn clicked');
          
          // Use computed style instead of inline style
          const currentDisplay = window.getComputedStyle(els.tasksList).display;
          const isCurrentlyVisible = currentDisplay !== 'none';
          
          logDebug(`Current computed display: "${currentDisplay}"`);
          logDebug(`Current visibility: ${isCurrentlyVisible}`);
          logDebug(`Current inline style: "${els.tasksList.style.display}"`);
          
          els.tasksList.style.display = isCurrentlyVisible ? 'none' : 'block';
          els.toggleTasksBtn.textContent = isCurrentlyVisible ? '+' : '−';
          
          logDebug(`New display style: "${els.tasksList.style.display}"`);
          logDebug(`Button text changed to: "${els.toggleTasksBtn.textContent}"`);
        });
      } else {
        logDebug('ERROR: toggleTasksBtn or tasksList not found');
      }
      
      if (els.toggleConsoleBtn && els.consoleBody) {
        logDebug('Setting up toggleConsoleBtn event listener');
        els.toggleConsoleBtn.addEventListener('click', () => {
          logDebug('toggleConsoleBtn clicked');
          
          // Use computed style instead of inline style
          const currentDisplay = window.getComputedStyle(els.consoleBody).display;
          const isCurrentlyVisible = currentDisplay !== 'none';
          
          logDebug(`Current computed display: "${currentDisplay}"`);
          logDebug(`Current visibility: ${isCurrentlyVisible}`);
          logDebug(`Current inline style: "${els.consoleBody.style.display}"`);
          
          els.consoleBody.style.display = isCurrentlyVisible ? 'none' : 'block';
          els.toggleConsoleBtn.textContent = isCurrentlyVisible ? '+' : '−';
          
          logDebug(`New display style: "${els.consoleBody.style.display}"`);
          logDebug(`Button text changed to: "${els.toggleConsoleBtn.textContent}"`);
          
          // Also toggle minimized class
          els.toggleConsoleBtn.parentElement.parentElement.parentElement.classList.toggle('minimized', isCurrentlyVisible);
          logDebug('Toggled minimized class on parent');
        });
      } else {
        logDebug('ERROR: toggleConsoleBtn or consoleBody not found');
      }
    }

    // Initialize on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      logDebug('DOM loaded, initializing...');
      initCollapsibleSections();
    });
  </script>
</body>
</html>
