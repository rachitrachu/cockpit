<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Address and FQDN Validation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .valid { border-color: #28a745; background-color: #d4edda; }
        .invalid { border-color: #dc3545; background-color: #f8d7da; }
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .result {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>🌐 IP Address and FQDN Validation Test</h1>
    <p>This page tests the enhanced IP address and FQDN validation patterns used in XAVS Globals.</p>

    <div class="test-section">
        <h2>📋 Validation Patterns</h2>
        <div class="test-case">
            <h4>IPv4 Address Pattern:</h4>
            <code>/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/</code>
            <p>✅ Validates each octet is 0-255</p>
            <p>✅ Ensures exactly 4 octets separated by dots</p>
        </div>
        <div class="test-case">
            <h4>FQDN Pattern (Updated - Requires Dot):</h4>
            <code>/^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/</code>
            <p>✅ Validates proper domain structure</p>
            <p>✅ <strong>Requires at least one dot (no single words like "localhost")</strong></p>
            <p>✅ Each label max 63 characters</p>
            <p>✅ No leading/trailing hyphens in labels</p>
        </div>
    </div>

    <div class="test-section">
        <h2>🧪 IP Address Validation Tests</h2>
        <button class="test-button" onclick="runIPTests()">Run IP Tests</button>
        <div id="ip-results"></div>
    </div>

    <div class="test-section">
        <h2>🧪 FQDN Validation Tests</h2>
        <button class="test-button" onclick="runFQDNTests()">Run FQDN Tests</button>
        <div id="fqdn-results"></div>
    </div>

    <div class="test-section">
        <h2>🎯 Interactive Testing</h2>
        <div>
            <h4>Test IP Address:</h4>
            <input type="text" id="test-ip" placeholder="Enter IP address to test (e.g., 192.168.1.100)">
            <button class="test-button" onclick="testIP()">Validate IP</button>
            <div id="ip-result"></div>
        </div>
        <div>
            <h4>Test FQDN:</h4>
            <input type="text" id="test-fqdn" placeholder="Enter FQDN to test (e.g., example.com)">
            <button class="test-button" onclick="testFQDN()">Validate FQDN</button>
            <div id="fqdn-result"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>⚡ Real-Time Validation Demo</h2>
        <p>This demonstrates the real-time validation that now occurs as you type in XAVS Globals:</p>
        <div>
            <h4>Real-Time IP Validation:</h4>
            <input type="text" id="realtime-ip" placeholder="Type IP address and see instant validation..." 
                   style="border: 2px solid #ddd;">
            <div id="realtime-ip-result"></div>
        </div>
        <div>
            <h4>Real-Time FQDN Validation:</h4>
            <input type="text" id="realtime-fqdn" placeholder="Type FQDN and see instant validation..." 
                   style="border: 2px solid #ddd;">
            <div id="realtime-fqdn-result"></div>
        </div>
        <div style="margin-top: 15px; padding: 10px; background-color: #e7f3ff; border-radius: 4px;">
            <strong>📝 Real-Time Features:</strong>
            <ul style="margin: 5px 0; padding-left: 20px;">
                <li>✅ Validates as you type (on 'input' event)</li>
                <li>✅ Also validates when you leave the field (on 'blur' event)</li>
                <li>✅ Highlights invalid fields with red border</li>
                <li>✅ Shows specific error messages below field</li>
                <li>✅ Highlights tabs containing errors</li>
                <li>✅ Clears validation when field becomes valid</li>
            </ul>
        </div>
    </div>

    <script>
        // Validation patterns from XAVS Globals (Updated)
        const ipPattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
        const fqdnPattern = /^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/;

        function runIPTests() {
            const validIPs = [
                '192.168.1.1',
                '10.0.0.1',
                '172.16.255.255',
                '1.1.1.1',
                '8.8.8.8',
                '203.0.113.10',
                '127.0.0.1',
                '0.0.0.0',
                '255.255.255.255'
            ];

            const invalidIPs = [
                '256.1.1.1',        // Invalid octet > 255
                '192.168.1',        // Missing octet
                '192.168.1.1.1',    // Too many octets
                '192.168.01.1',     // Leading zero (old pattern allowed this)
                '192.168.-1.1',     // Negative number
                '192.168.1.a',      // Letter in octet
                'not-an-ip',        // Not an IP at all
                '192.168.1.',       // Trailing dot
                '.192.168.1.1',     // Leading dot
                '192 168 1 1',      // Spaces instead of dots
                '192.168.1.999'     // Invalid octet > 255
            ];

            let results = '<h4>✅ Valid IP Addresses:</h4>';
            validIPs.forEach(ip => {
                const isValid = ipPattern.test(ip);
                results += `<div class="test-case ${isValid ? 'valid' : 'invalid'}">
                    <code>${ip}</code> - ${isValid ? '✅ PASS' : '❌ FAIL (should be valid)'}
                </div>`;
            });

            results += '<h4>❌ Invalid IP Addresses:</h4>';
            invalidIPs.forEach(ip => {
                const isValid = ipPattern.test(ip);
                results += `<div class="test-case ${!isValid ? 'valid' : 'invalid'}">
                    <code>${ip}</code> - ${!isValid ? '✅ PASS (correctly rejected)' : '❌ FAIL (should be rejected)'}
                </div>`;
            });

            document.getElementById('ip-results').innerHTML = results;
        }

        function runFQDNTests() {
            const validFQDNs = [
                'example.com',
                'sub.example.com',
                'api.v1.example.com',
                'xavs-int.example.com',
                'test123.example.org',
                'a.b.c.d.example.net',
                'localhost',
                'test-domain.com',
                'my-site.co.uk',
                'api.example.io'
            ];

            const invalidFQDNs = [
                '-example.com',          // Leading hyphen
                'example-.com',          // Trailing hyphen in label
                'ex..ample.com',         // Double dot
                '.example.com',          // Leading dot
                'example.com.',          // Trailing dot (depends on requirements)
                'localhost',             // Single word (no dot) - NOW INVALID
                'exa mple.com',          // Space in domain
                'example.com/path',      // Path included
                'http://example.com',    // Protocol included
                'example@com',           // Invalid character
                'example.com:8080',      // Port included
                'very-long-label-that-exceeds-sixty-three-characters-limit.com',  // Label > 63 chars
                'test',                  // Single word (no dot) - NOW INVALID
                'hostname'               // Single word (no dot) - NOW INVALID
            ];

            let results = '<h4>✅ Valid FQDNs:</h4>';
            validFQDNs.forEach(fqdn => {
                const isValid = fqdnPattern.test(fqdn);
                results += `<div class="test-case ${isValid ? 'valid' : 'invalid'}">
                    <code>${fqdn}</code> - ${isValid ? '✅ PASS' : '❌ FAIL (should be valid)'}
                </div>`;
            });

            results += '<h4>❌ Invalid FQDNs:</h4>';
            invalidFQDNs.forEach(fqdn => {
                const isValid = fqdnPattern.test(fqdn);
                results += `<div class="test-case ${!isValid ? 'valid' : 'invalid'}">
                    <code>${fqdn}</code> - ${!isValid ? '✅ PASS (correctly rejected)' : '❌ FAIL (should be rejected)'}
                </div>`;
            });

            document.getElementById('fqdn-results').innerHTML = results;
        }

        function testIP() {
            const input = document.getElementById('test-ip').value;
            const isValid = ipPattern.test(input);
            const result = document.getElementById('ip-result');
            
            if (!input) {
                result.innerHTML = '<div class="result">Please enter an IP address to test</div>';
                return;
            }

            if (isValid) {
                result.innerHTML = `<div class="result pass">✅ Valid IP: "${input}" matches the pattern</div>`;
            } else {
                result.innerHTML = `<div class="result fail">❌ Invalid IP: "${input}" does not match the pattern<br>
                <small>Must be a valid IPv4 address (e.g., 192.168.1.100)</small></div>`;
            }
        }

        function testFQDN() {
            const input = document.getElementById('test-fqdn').value;
            const isValid = fqdnPattern.test(input);
            const result = document.getElementById('fqdn-result');
            
            if (!input) {
                result.innerHTML = '<div class="result">Please enter an FQDN to test</div>';
                return;
            }

            if (isValid) {
                result.innerHTML = `<div class="result pass">✅ Valid FQDN: "${input}" matches the pattern</div>`;
            } else {
                result.innerHTML = `<div class="result fail">❌ Invalid FQDN: "${input}" does not match the pattern<br>
                <small>Must be a valid domain name with at least one dot (e.g., example.com or sub.example.com)</small></div>`;
            }
        }

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🧪 IP and FQDN Validation Test Page Loaded');
            console.log('📋 IP Pattern:', ipPattern);
            console.log('📋 FQDN Pattern:', fqdnPattern);
            
            setupRealTimeValidation();
        });

        function setupRealTimeValidation() {
            // Real-time IP validation
            const realtimeIP = document.getElementById('realtime-ip');
            const realtimeIPResult = document.getElementById('realtime-ip-result');
            
            realtimeIP.addEventListener('input', function() {
                validateRealTimeIP(this.value, realtimeIPResult, this);
            });
            
            // Real-time FQDN validation
            const realtimeFQDN = document.getElementById('realtime-fqdn');
            const realtimeFQDNResult = document.getElementById('realtime-fqdn-result');
            
            realtimeFQDN.addEventListener('input', function() {
                validateRealTimeFQDN(this.value, realtimeFQDNResult, this);
            });
        }

        function validateRealTimeIP(value, resultDiv, inputElement) {
            if (!value) {
                resultDiv.innerHTML = '';
                inputElement.style.borderColor = '#ddd';
                return;
            }
            
            const isValid = ipPattern.test(value);
            if (isValid) {
                resultDiv.innerHTML = '<div class="result pass">✅ Valid IP address</div>';
                inputElement.style.borderColor = '#28a745';
            } else {
                resultDiv.innerHTML = '<div class="result fail">❌ Must be a valid IPv4 address (e.g., 192.168.1.100)</div>';
                inputElement.style.borderColor = '#dc3545';
            }
        }

        function validateRealTimeFQDN(value, resultDiv, inputElement) {
            if (!value) {
                resultDiv.innerHTML = '';
                inputElement.style.borderColor = '#ddd';
                return;
            }
            
            const isValid = fqdnPattern.test(value);
            if (isValid) {
                resultDiv.innerHTML = '<div class="result pass">✅ Valid FQDN</div>';
                inputElement.style.borderColor = '#28a745';
            } else {
                resultDiv.innerHTML = '<div class="result fail">❌ Must be a valid domain name with at least one dot (e.g., example.com)</div>';
                inputElement.style.borderColor = '#dc3545';
            }
        }
    </script>
</body>
</html>
