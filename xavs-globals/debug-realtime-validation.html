<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Real-Time Validation</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .form-group { margin: 20px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px; }
        input.is-invalid { border-color: #dc3545; }
        .real-time-validation-error { color: #dc3545; font-size: 12px; margin-top: 5px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üêõ Real-Time Validation Debug</h1>
    
    <div class="debug" id="debug-log">Debug output will appear here...</div>
    
    <div class="form-group">
        <label for="basics_kolla_internal_vip_address">Internal VIP Address</label>
        <input type="text" id="basics_kolla_internal_vip_address" name="basics_kolla_internal_vip_address" 
               placeholder="e.g., 192.168.1.100">
    </div>
    
    <div class="form-group">
        <label for="basics_kolla_internal_fqdn">Internal FQDN</label>
        <input type="text" id="basics_kolla_internal_fqdn" name="basics_kolla_internal_fqdn" 
               placeholder="e.g., xavs-int.example.com">
    </div>

    <script>
        const debugLog = document.getElementById('debug-log');
        
        function log(message) {
            console.log(message);
            debugLog.innerHTML += message + '<br>';
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        // Mock schema (from XAVS Globals)
        const schema = {
            'kolla_internal_vip_address': {
                validation: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/
            },
            'kolla_internal_fqdn': {
                validation: /^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/
            }
        };

        function validateFieldRealTime(input, fieldDef, fieldName) {
            log(`üîç Real-time validation for ${fieldName}: "${input.value}"`);
            
            const value = input.value.trim();
            const labelElement = input.closest('.form-group')?.querySelector('label');
            const label = labelElement ? labelElement.textContent : fieldName;
            
            // Clear previous validation state
            input.classList.remove('is-invalid');
            
            // Remove any existing error messages for this field
            const existingError = input.parentNode?.querySelector('.real-time-validation-error');
            if (existingError) {
                existingError.remove();
            }
            
            // Only validate if field has content
            if (value && fieldDef.validation) {
                try {
                    const re = fieldDef.validation;
                    const isValid = re.test(value);
                    log(`üìã Validation result for ${fieldName}: ${isValid ? 'VALID ‚úÖ' : 'INVALID ‚ùå'}`);
                    
                    if (!isValid) {
                        // Add validation error styling
                        input.classList.add('is-invalid');
                        
                        // Generate specific error message
                        let errorMsg = `${label.trim()} has invalid format`;
                        if (fieldName.includes('vip_address') || fieldName.includes('_address')) {
                            errorMsg = `Must be a valid IPv4 address (e.g., 192.168.1.100)`;
                        } else if (fieldName.includes('fqdn')) {
                            errorMsg = `Must be a valid domain name with at least one dot (e.g., example.com)`;
                        }
                        
                        // Create and show error message
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'real-time-validation-error';
                        errorDiv.textContent = errorMsg;
                        input.parentNode.appendChild(errorDiv);
                        
                        log(`‚ùå Added error message: ${errorMsg}`);
                    } else {
                        log(`‚úÖ Valid input - no errors`);
                    }
                } catch (e) {
                    log(`‚ö†Ô∏è Validation error: ${e.message}`);
                }
            } else {
                log(`‚ÑπÔ∏è No validation needed (empty field or no validation pattern)`);
            }
        }

        function setupRealTimeValidation() {
            log('üîß Setting up real-time validation...');
            
            const inputs = document.querySelectorAll('input[type="text"]');
            log(`üìù Found ${inputs.length} text inputs for real-time validation`);
            
            inputs.forEach(input => {
                const fieldName = input.name ? input.name.split('_').slice(1).join('_') : '';
                const fieldDef = schema[fieldName];
                
                log(`üîç Checking field: ${fieldName} - Has validation: ${!!fieldDef?.validation}`);
                
                if (fieldDef && fieldDef.validation) {
                    log(`‚úÖ Adding real-time validation to: ${fieldName}`);
                    
                    // Add input event listener for real-time validation
                    input.addEventListener('input', (e) => {
                        log(`‚ö° Input event triggered for: ${fieldName}`);
                        validateFieldRealTime(e.target, fieldDef, fieldName);
                    });
                    
                    // Also validate on blur for more thorough checking
                    input.addEventListener('blur', (e) => {
                        log(`üéØ Blur event triggered for: ${fieldName}`);
                        validateFieldRealTime(e.target, fieldDef, fieldName);
                    });
                } else {
                    log(`‚ùå No validation pattern found for: ${fieldName}`);
                }
            });
            
            log('‚úÖ Real-time validation setup complete!');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Page loaded - starting real-time validation setup...');
            setupRealTimeValidation();
        });
    </script>
</body>
</html>
